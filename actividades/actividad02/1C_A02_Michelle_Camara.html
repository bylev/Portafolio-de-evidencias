<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de la recta numérica - Números Complejos</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&family=Playwrite+GB+J:ital,wght@0,100..400;1,100..400&display=swap" rel="stylesheet" rel="stylesheet">

    <style>
        /* ==================== RESET BÁSICO ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ==================== ESTRUCTURA GENERAL ==================== */
        body {
            font-family:"Lexend Deca", sans-serif;
            background-color: #fdfcf9;
            color: #39190F;
            padding: 20px;
            line-height: 1.6;
            font-size: 16px;
        }
        .container {
            max-width: 950px;
            background-color: #fffaf5;
            border: 3px solid #d8b99b;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 6px 6px 0 #b08968;
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 0 auto;
        }

        /* ==================== ENCABEZADOS ==================== */
        .banner{
            text-align: center;
            margin-bottom: 20px;
        }  
        .h1{
            font-family: "Playwrite GB J", cursive;
            align-items: center;
            text-align: center;
            font-size: 26px;
            color: #6f4e37;
            background: #f3e5d0;
            display: inline-block;
            padding: 12px 25px;
            border-radius: 15px;
            border: 2px dashed #b08968;
            box-shadow: 2px 2px 0 #a47551;
        }
        h1{
            animation-duration: 3s;
            animation-name: slidein;
            animation-direction: normal;
            animation-iteration-count: 1;
            animation-timing-function: ease-out;
            display: block;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }
        @keyframes slidein {
            from {
            margin-left: auto;
            margin-right: auto;
            transform: translateX(-100%);
            width: 300%;
            }
            to {
            margin-left: auto;
            margin-right: auto;
            transform: translateX(0%);
            width: 100%;
            }
        }

        .meta{
                margin-top: 8px;
                font-size: 14px;
                color: #8c5c42;
                animation-duration: 3s;
                animation-name: slidein;
                animation-direction: normal;
                animation-iteration-count: 1;
                animation-timing-function: ease-out;
        }

        .instructions{
                background-color: #f7ede2;
                border: 2px solid #e3c9b1;
                padding: 15px;
                border-radius: 8px;
                font-size: 14px;
                color: #5c4033;
                overflow: hidden;
                white-space: nowrap;
                border-right: 2px solid #a47551;
                animation: blink-caret 0.7s step-end 7;
                animation-fill-mode: forwards;
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #a47551; }
        }
        .instructions strong{
                color: #a47551;
                font-size: 16px;
        }
        .instructions ul{
                margin-top: 8px;
                list-style-type: disc;
                padding-left: 20px;
        }

        /* ==================== SECCIONES Y FORMULARIOS ==================== */
        .form-section{
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            background-color: #fffdf9;
            border: 2px solid #e3c9b1;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 3px 3px 0 #d1a280;
            display: flex;
            flex-direction: column;
            gap: 15px;

            /* Animación de aparición */
            opacity: 0;
            animation: fadein 1.2s ease-in forwards;
        }

        @keyframes fadein {
            from { opacity: 0; }
            to   { opacity: 1; }
        }
        
        section{ 
            padding: 22px 24px; 
            background-color: #fffdf9;
            border: 2px solid #e3c9b1;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 3px 3px 0 #d1a280;
        }
        section + section{ 
            border-top: 1px solid #dde4ea; 
        }

        .controls h2,
        .number-line-container h2,
        .info-panels h3{ 
            color:#6f4e37; 
            font-size: 16px;
            margin-bottom: 12px;
            border-bottom: 1px dashed #d8b99b;
            padding-bottom: 5px;
        }

    .controls .input-group{
      margin-top:14px;
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items: end;
    }
    .controls label{ font-size:14px; color:#6c7785; }
        .controls input[type="text"]{
            grid-column: 1 / span 1;
            padding: 8px 10px;
            border: 2px solid #d8b99b;
            border-radius: 8px;
            background: #fdfaf6;
            font-family: "Courier New", monospace;
            text-align: center;
            color: #39190F;
            font-size: 15px;
            outline: none;
        }
        .controls input[type="text"]:focus {
            outline: none;
            border-color: #a47551;
            box-shadow: inset 2px 2px 0 #d8b99b;
        }
        .controls input[type="text"]::placeholder{ 
            color:#8c5c42; 
        }

        .btn{
            padding: 12px 24px;
            border-radius: 30px;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 3px 3px 0 #a47551;
            transition: transform .02s ease, box-shadow .2s ease;
            white-space: nowrap;
        }
        .btn:hover{ 
            box-shadow: 2px 2px 0 #39190F; 
        }
        .btn:active{ 
            box-shadow: none;
            transform: translateY(2px); 
        }
        .btn.primary{
            background: #d1a280;
            color: white;
        }
        .btn.primary:hover {
            background: #6f4e37;
        }
        .btn.danger{
            background: #d1a280;
            color: white;
        }
        .btn.danger:hover {
            background: #6f4e37;
        }

        .back-btn {
            background: #8c5c42;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 3px 3px 0 #6f4e37;
            display: block;
            margin: 20px auto;
            text-decoration: none;
            text-align: center;
            width: fit-content;
            max-width: 950px;
            opacity: 0;
            animation: fadein 1.2s ease-in forwards;
            animation-delay: 0.3s;
        }
        .back-btn:hover { background: #39190F; box-shadow: 2px 2px 0 #6f4e37; }
        .back-btn:active { box-shadow: none; transform: translateY(2px); }

    .preset-section{ margin-top:18px; }
    .preset-numbers{
      margin-top:10px;
      display:flex; flex-wrap:wrap; gap:8px;
    }
        .preset-btn{
            display:inline-block;
            padding:8px 12px;
            border-radius:999px;
            border:1px dashed #b08968;
            background:#f3e5d0;
            color:#5c4033;
            cursor:pointer;
            font-weight:600;
            user-select:none;
            transition: background .15s ease, transform .02s ease;
        }
        .preset-btn:hover{ 
            background:#e5cbcc; 
        }
        .preset-btn:active{ 
            transform: translateY(1px); 
        }

        /* Recta Númerica */
        .number-line-container{ 
            padding-top: 8px; 
        }
        .number-line{
            position: relative;
            height: 140px;
            border: 2px solid #d8b99b;
            background: linear-gradient(180deg,#fffaf5, #f7ede2);
            border-radius: 12px;
            margin-top: 12px;
            overflow: hidden;
            box-shadow: inset 2px 2px 0 #d1a280;
        }
        .line{
            position:absolute;
            left:5%; right:5%;
            top:50%;
            height: 4px;
            background:#a47551;
            border-radius: 6px;
            transform: translateY(-50%);
        }

        .tick{
            position:absolute;
            width:2px;
            height:16px;
            top:calc(50% - 8px);
            background:#6f4e37;
            opacity:.8;
        }
        .tick-label{
            position:absolute;
            top: calc(50% + 16px);
            transform: translateX(-50%);
            font-size: 12px;
            color:#5c4033;
            filter: drop-shadow(0 1px 0 rgba(255,255,255,.9));
            user-select:none;
        }

        /* Puntos */
        .number-point{
            position:absolute;
            top:50%;
            transform: translate(-50%,-50%);
            width:16px; height:16px;
            border-radius: 50%;
            border:2px solid #fff;
            box-shadow: 0 2px 7px rgba(0,0,0,.18);
            cursor:pointer;
        }
        .number-point.naturals{ background: #e74c3c; }
        .number-point.integers{ background: #f39c12; }
        .number-point.rationals{ background: #27ae60; }
        .number-point.irrationals{ background: #8e44ad; }

        .point-label{
            position:absolute;
            left:50%;
            transform: translateX(-50%);
            bottom: 22px;
            background:#fffaf5;
            color:#39190F;
            border:1px solid #d8b99b;
            border-radius:8px;
            padding:6px 8px;
            font-size:12px;
            white-space: nowrap;
            pointer-events:none;
            box-shadow: 0 4px 12px rgba(0,0,0,.08);
        }
        .number-point:hover .point-label{ 
            filter: brightness(0.98); 
        }

        /* Paneles */
        .info-panels{
            display:grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
        }
        @media (max-width: 960px){
            .info-panels{ 
                grid-template-columns: 1fr 1fr 1fr; 
                gap: 12px;
            }
            .controls .input-group{ grid-template-columns: 1fr; }
        }

        .card{
            background:#fffdf9;
            border:2px solid #e3c9b1;
            border-radius:15px;
            padding:25px;
            box-shadow: 3px 3px 0 #d1a280;
        }

        .classification-legend{ 
            display:grid; 
            gap:8px; 
            margin-top:8px; 
        }
        .legend-item{ 
            display:flex; 
            align-items:center; 
            gap:8px; 
            font-size:14px; 
            color:#5c4033; 
        }
        .legend-color{ 
            width:14px; 
            height:14px; 
            border-radius: 3px; 
            border:1px solid #d8b99b; 
        }
        .legend-color.naturals{ background: #e74c3c; }
        .legend-color.integers{ background: #f39c12; }
        .legend-color.rationals{ background: #27ae60; }
        .legend-color.irrationals{ background: #8e44ad; }
        .classification-info{ 
            margin-top:10px; 
        }
        .classification-info ul{ 
            margin-left: 18px; 
            margin-top:6px; 
        }
        .classification-info li{ 
            margin: 4px 0; 
            color:#5c4033; 
        }

        /* Lista de puntos */
        #pointsList .empty-state{
            text-align:center; 
            padding:16px; 
            border:1px dashed #d8b99b; 
            border-radius:10px; 
            background:#f7ede2;
            color:#5c4033;
        }
        .point-item{
            display:flex; 
            align-items:center; 
            justify-content:space-between; 
            gap:10px;
            background:#fffaf5; 
            border:1px solid #e3c9b1; 
            border-left:6px solid #27ae60;
            border-radius:10px; 
            padding:10px 12px; 
            margin:8px 0;
            color:#39190F;
        }
        .point-item small{ 
            color:#8c5c42; 
        }

        /* Calcula la distancia */
        .distance-description{ 
            color:#5c4033; 
            margin-top:6px; 
        }
        .distance-inputs{ 
            display:grid; 
            grid-template-columns: 1fr 1fr; 
            gap:10px; 
            margin-top:10px; 
        }
        @media (max-width: 640px){ 
            .distance-inputs{ grid-template-columns: 1fr; } 
        }

        .distance-field{ 
            display:flex; 
            flex-direction:column; 
            gap:6px; 
            position:relative; 
            z-index:100; 
        }
        .custom-select{ 
            user-select:none; 
            position:relative; 
        }
        .select-selected{
            background:#fdfaf6; 
            border:2px solid #d8b99b; 
            border-radius:8px; 
            padding:8px 10px; 
            cursor:pointer; 
            position:relative;
            font-family: "Courier New", monospace;
            color:#39190F;
        }
        .select-selected.select-arrow-active::after{ 
            rotate:180deg; 
        }
        .select-selected::after{
            content:"▾"; 
            position:absolute; 
            right:10px; 
            top:50%; 
            transform: translateY(-50%);
            font-size:14px; 
            color:#8c5c42;
        }
        .select-items{
            position:absolute; 
            left:0; 
            right:0; 
            top: calc(100% + 4px);
            background:#fffaf5; 
            border:2px solid #d8b99b; 
            border-radius:8px; 
            padding:6px; 
            display:none;
            max-height:220px; 
            overflow:auto; 
            box-shadow: 0 8px 20px rgba(0,0,0,.08);
        }
        .select-items.show{ 
            display:block; 
        }
        .select-items div{
            padding:8px 10px; 
            border-radius:8px; 
            cursor:pointer; 
            color:#39190F;
        }
        .select-items div:hover{ 
            background:#f3e5d0; 
        }
        .select-items .selected{ 
            background:#e5cbcc; 
            font-weight:600; 
        }

        .distance-btn{
            margin-top:10px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .distance-placeholder{
            margin-top:8px; 
            padding:12px; 
            border-radius:10px; 
            background:#f7ede2; 
            border:1px dashed #d8b99b; 
            color:#5c4033; 
            text-align:center;
        }
        .distance-result{
            margin-top:10px; 
            padding:12px; 
            border-radius:10px; 
            background:#e5cbcc; 
            border:1px solid #d8b99b; 
            color:#39190F; 
            font-weight:600;
        }

        .range-info{ 
            margin-top:8px; 
            color:#8c5c42; 
        }
        /* ==================== FIN DE ESTILOS ==================== */
    </style>
    
</head>
<body>
    <div class="container">
        <div class="banner">
        <h1><span class="h1">Visualizador de la recta numérica</span></h1>
        <p class="meta">Tecnológico de Software · Fundamentos de Álgebra · Prof. Jorge Javier Pedrozo Romero · 1°C · Cuatrimestre 1 · Michelle Cámara González</p></div>
        <div class="instructions">
            <strong>✦ Instrucciones: </strong>
            <ul>
                <li>Ingresa números en diferentes formatos: decimales, fracciones, raíces, constantes</li>
                <li>Usa π para pi, √ para raíces cuadradas, e para número de Euler</li>
                <li>Los números se clasificarán automáticamente por tipo (naturales, enteros, racionales, irracionales)</li>
                <li>Haz clic en los números predefinidos para agregarlos rápidamente</li>
                <li>Los puntos en la recta numérica muestran la clasificación por color</li>
            </ul>
        </div>

    <section class="controls">
      <h2>Controles de entrada</h2>

      <div class="input-group">
        <div>
          <label for="numberInput">Valor del número</label>
          <input type="text" id="numberInput" placeholder="Ej: sqrt(7), 2*π, √2, 1/3, pi/2, 3^2">
        </div>
        <button type="button" class="btn primary" onclick="addNumber()">Agregar número</button>
        <button type="button" class="btn danger" onclick="clearAll()">Limpiar todo</button>
    
    </div>      <div class="preset-section">
        <h3>Números predefinidos</h3>
        <p>Haz clic en cualquier número para agregarlo automáticamente:</p>
        <div class="preset-numbers">
          <span class="preset-btn" onclick="addPresetNumber('π')">π</span>
          <span class="preset-btn" onclick="addPresetNumber('e')">e</span>
          <span class="preset-btn" onclick="addPresetNumber('√2')">√2</span>
          <span class="preset-btn" onclick="addPresetNumber('√3')">√3</span>
          <span class="preset-btn" onclick="addPresetNumber('φ')">φ</span>
          <span class="preset-btn" onclick="addPresetNumber('1/3')">1/3</span>
          <span class="preset-btn" onclick="addPresetNumber('-1/2')">-1/2</span>
          <span class="preset-btn" onclick="addPresetNumber('2.5')">2.5</span>
          <span class="preset-btn" onclick="addPresetNumber('-√2')">-√2</span>
          <span class="preset-btn" onclick="addPresetNumber('2*π')">2*π</span>
        </div>
      </div>
    </section>

    <section class="number-line-container">
      <h2>Recta numérica interactiva</h2>
      <div class="number-line" id="numberLine"></div>
      <p class="range-info">
        <small>Rango de visualización: -10 a +10 <u>(números fuera de este rango no se mostrarán).</u></small>
      </p>
    </section>

    <section class="info-panels">
      <!-- Panel clasificación -->
      <div class="card">
        <h3>Clasificación de conjuntos numéricos</h3>
        <div class="classification-legend">
          <div class="legend-item">
            <div class="legend-color naturals"></div>
            <span><strong>ℕ - Naturales:</strong> {1, 2, 3, 4, ...}</span>
          </div>
          <div class="legend-item">
            <div class="legend-color integers"></div>
            <span><strong>ℤ - Enteros:</strong> {..., -2, -1, 0, 1, 2, ...}</span>
          </div>
          <div class="legend-item">
            <div class="legend-color rationals"></div>
            <span><strong>ℚ - Racionales:</strong> Fracciones y decimales finitos/periódicos</span>
          </div>
          <div class="legend-item">
            <div class="legend-color irrationals"></div>
            <span><strong>ℝ-ℚ - Irracionales:</strong> π, e, √2, decimales infinitos no periódicos</span>
          </div>
        </div>
        <div class="classification-info">
          <h4>Propiedades importantes:</h4>
          <ul>
            <li><strong>ℕ ⊂ ℤ:</strong> Todo número natural es entero</li>
            <li><strong>ℤ ⊂ ℚ:</strong> Todo entero puede escribirse como fracción</li>
            <li><strong>ℚ ∪ (ℝ-ℚ) = ℝ:</strong> Los reales son la unión de racionales e irracionales</li>
            <li><strong>ℚ ∩ (ℝ-ℚ) = ∅:</strong> No hay números que sean ambos</li>
          </ul>
        </div>
      </div>

      <!-- Panel lista de puntos -->
      <div class="card">
        <h3>Puntos en la recta</h3>
        <div id="pointsList">
          <div class="empty-state">
            <p>Agrega números para ver su clasificación automática aquí</p>
            <small>Los puntos aparecerán ordenados de menor a mayor</small>
          </div>
        </div>
      </div>

      <!-- Panel calculadora -->
      <div class="card">
        <h3>Calculadora de distancias</h3>
        <p class="distance-description">Selecciona dos puntos para calcular la distancia entre ellos en la recta numérica.</p>

        <div class="distance-inputs">
          <div class="distance-field">
            <label>Punto A:</label>
            <div class="custom-select" id="pointA-container" data-value="">
              <div class="select-selected" id="pointA-selected">Selecciona un punto</div>
              <div class="select-items" id="pointA-items"><div data-value="">Selecciona un punto</div></div>
            </div>
          </div>
          <div class="distance-field">
            <label>Punto B:</label>
            <div class="custom-select" id="pointB-container" data-value="">
              <div class="select-selected" id="pointB-selected">Selecciona un punto</div>
              <div class="select-items" id="pointB-items"><div data-value="">Selecciona un punto</div></div>
            </div>
          </div>
        </div>

        <button type="button" class="btn distance-btn" onclick="calculateDistance()">Calcular distancia</button>

        <div id="distanceResult">
          <div class="distance-placeholder">
            <div><strong>Calculadora de distancias</strong></div>
            <div>Los resultados aparecerán aquí</div>
          </div>
          </div>
        </div>
          <div class="distance-placegolder">
          </
      </div>
    </section>
  </div>

  <a href="../../index.html" class="back-btn">← Regresar al Portafolio</a>

  <script>
    // ======== ESTADO GLOBAL ========
    let points = [];
    let currentRange = 10;

    // ======== CONSTANTES MATEMÁTICAS ========
    const CONSTANTS = {
      'π': Math.PI, 'pi': Math.PI,
      'e': Math.E,
      'φ': (1 + Math.sqrt(5)) / 2, 'phi': (1 + Math.sqrt(5)) / 2,
      'τ': 2 * Math.PI, 'tau': 2 * Math.PI,
      'ln2': Math.LN2, 'ln10': Math.LN10,
      '√2': Math.sqrt(2), '√3': Math.sqrt(3), '√5': Math.sqrt(5),
      '√7': Math.sqrt(7), '√8': Math.sqrt(8), '√10': Math.sqrt(10),
      '√11': Math.sqrt(11), '√12': Math.sqrt(12), '√13': Math.sqrt(13),
      '√15': Math.sqrt(15), '√17': Math.sqrt(17), '√19': Math.sqrt(19),
      '√20': Math.sqrt(20),
      '-√2': -Math.sqrt(2), '-√3': -Math.sqrt(3), '-√5': -Math.sqrt(5)
    };

    // ======== PARSING ========
    function parseNumber(input){
      input = (input || '').trim().replace(/\s+/g, '');

      if (CONSTANTS.hasOwnProperty(input)) return CONSTANTS[input];

      // Sustituimos constantes en expresiones
      let processedInput = input;
      for (const [sym, val] of Object.entries(CONSTANTS)){
        const re = new RegExp(sym.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
        processedInput = processedInput.replace(re, val.toString());
      }

      // Fracción simple
      if (input.includes('/') && !/[+*]/.test(input) && input.indexOf('-',1) === -1){
        const [n,d] = input.split('/');
        const num = parseFloat(n), den = parseFloat(d);
        if (!isNaN(num) && !isNaN(den) && den !== 0) return num/den;
      }

      // √n y -√n
      if (input.startsWith('√') && !/[+*]/.test(input) && input.indexOf('-',1) === -1){
        const r = parseFloat(input.slice(1));
        if (!isNaN(r) && r>=0) return Math.sqrt(r);
      }
      if (input.startsWith('-√') && !input.includes('+') && !input.includes('*')){
        const r = parseFloat(input.slice(2));
        if (!isNaN(r) && r>=0) return -Math.sqrt(r);
      }

      // sqrt(expr)
      if (input.includes('sqrt(')){
        const sqrtPattern = /sqrt\(([^)]+)\)/g;
        let processedInputSqrt = input, m;
        while ((m = sqrtPattern.exec(input)) !== null){
          const inner = m[1]; let innerVal;
          try{
            if (inner.includes('/') && !/[+*]/.test(inner) && inner.indexOf('-',1) === -1){
              const [n,d] = inner.split('/');
              const num = parseFloat(n), den = parseFloat(d);
              if (!isNaN(num) && !isNaN(den) && den !== 0) innerVal = num/den;
            } else {
              const safe = /^[0-9+\-*/.() ]+$/;
              innerVal = safe.test(inner) ? Function('"use strict";return('+inner+')')() : parseFloat(inner);
            }
            if (!isNaN(innerVal) && innerVal>=0){
              processedInputSqrt = processedInputSqrt.replace(m[0], Math.sqrt(innerVal).toString());
            }
          }catch(_){}
        }
        if (/^sqrt\([^)]+\)$/.test(input)){
          const inner = input.match(/sqrt\(([^)]+)\)/)[1];
          let innerVal;
          try{
            if (inner.includes('/') && !/[+*]/.test(inner) && inner.indexOf('-',1)===-1){
              const [n,d] = inner.split('/'); const num=parseFloat(n), den=parseFloat(d);
              if (!isNaN(num)&&!isNaN(den)&&den!==0) innerVal=num/den;
            } else {
              const safe=/^[0-9+\-*/.() ]+$/; innerVal=safe.test(inner)?Function('"use strict";return('+inner+')')():parseFloat(inner);
            }
            if (!isNaN(innerVal) && innerVal>=0) return Math.sqrt(innerVal);
          }catch(_){}
        }
        processedInput = processedInputSqrt;
      }


      try{
        processedInput = processedInput.replace(/\^/g,'**');
        const safe = /^[0-9+\-*/.() ]+$/;
        if (safe.test(processedInput)){
          const res = Function('"use strict";return('+processedInput+')')();
          if (typeof res === 'number' && isFinite(res)) return res;
        }
      }catch(_){}

      const num = parseFloat(processedInput);
      if (!isNaN(num)) return num;

      return null;
    }

    // ======== CLASIFICACIÓN ========
    function normalizeExpression(expr){ return expr.replace(/\s/g,'').replace(/\*\*/g,'^').toLowerCase(); }

    function getClassificationName(c){
      return { naturals:'ℕ (Naturales)', integers:'ℤ (Enteros)', rationals:'ℚ (Racionales)', irrationals:'ℝ-ℚ (Irracionales)'}[c] || 'No clasificado';
    }

    function classifyExpression(expression, result){
      const normalizedExpr = normalizeExpression(expression);
      const knownRationalResults = [
        {pattern:/^π\/π$/,result:1},{pattern:/^pi\/pi$/,result:1},{pattern:/^e\/e$/,result:1},
        {pattern:/^φ\/φ$/,result:1},{pattern:/^phi\/phi$/,result:1},{pattern:/^τ\/τ$/,result:1},{pattern:/^tau\/tau$/,result:1},
        {pattern:/^√2\/√2$/,result:1},{pattern:/^√3\/√3$/,result:1},{pattern:/^√5\/√5$/,result:1},
        {pattern:/^π-π$/,result:0},{pattern:/^pi-pi$/,result:0},{pattern:/^e-e$/,result:0},
        {pattern:/^2\*π\/τ$/,result:1},{pattern:/^τ\/2\*π$/,result:1},
      ];
      for (const k of knownRationalResults){
        if (k.pattern.test(normalizedExpr) && Math.abs(result - k.result) < 1e-4){
          if (k.result > 0 && Number.isInteger(k.result)) return 'naturals';
          if (Number.isInteger(k.result)) return 'integers';
          return 'rationals';
        }
      }
      const specialRationalCases = [/π\/π/,/pi\/pi/,/e\/e/,/φ\/φ/,/phi\/φ/,/τ\/τ/,/tau\/tau/,/√2\/√2/,/√3\/√3/,/√5\/√5/,/π-π/,/pi-pi/,/e-e/];
      if (specialRationalCases.some(p => p.test(expression.replace(/\s/g,'')))){
        if (result>0 && Number.isInteger(result)) return 'naturals';
        if (Number.isInteger(result)) return 'integers';
        return 'rationals';
      }
      const irrSyms = ['π','pi','e','φ','phi','τ','tau','ln2','ln10','√','sqrt'];
      const containsIrr = irrSyms.some(s => expression.includes(s));
      if (containsIrr){
        const rationalResultPatterns = [/π\+\(-π\)/,/pi\+\(-pi\)/,/e\+\(-e\)/,/π-π/,/pi-pi/,/e-e/,/τ-τ/,/tau-tau/,/√2-√2/];
        if (rationalResultPatterns.some(p => p.test(expression.replace(/\s/g,'')))){
          if (result>0 && Number.isInteger(result)) return 'naturals';
          if (Number.isInteger(result)) return 'integers';
          return 'rationals';
        }
        return 'irrationals';
      }
      if (result>0 && Number.isInteger(result)) return 'naturals';
      if (Number.isInteger(result)) return 'integers';
      return 'rationals';
    }

    function classifyNumber(num, originalInput){
      if (num>0 && Number.isInteger(num)) return 'naturals';
      if (Number.isInteger(num)) return 'integers';

      const irrConsts = ['π','pi','e','φ','phi','τ','tau','ln2','ln10','√2','√3','√5','√7','√8','√10','√11','√12','√13','√15','√17','√19','√20','-√2','-√3','-√5'];
      if (irrConsts.includes(originalInput)) return 'irrationals';

      if (originalInput.includes('sqrt(')){
        const m = originalInput.match(/sqrt\(([^)]+)\)/);
        if (m){
          let innerVal;
          try{
            const inner = m[1];
            if (inner.includes('/') && !/[+*]/.test(inner) && inner.indexOf('-',1)===-1){
              const [n,d] = inner.split('/'); const a=parseFloat(n), b=parseFloat(d);
              if (!isNaN(a)&&!isNaN(b)&&b!==0) innerVal=a/b;
            } else {
              const safe=/^[0-9+\-*/.() ]+$/; innerVal = safe.test(inner) ? Function('"use strict";return('+inner+')')() : parseFloat(inner);
            }
            if (!isNaN(innerVal) && innerVal>=0){
              const r = Math.sqrt(innerVal);
              if (Number.isInteger(r)) return r>0 ? 'naturals':'integers';
              return 'irrationals';
            }
          }catch(_){ return 'irrationals'; }
        }
      }

      if (/[+\-*/]/.test(originalInput)) return classifyExpression(originalInput, num);
      if (originalInput.includes('/')) return 'rationals';
      return 'rationals';
    }

    // ======== FUNCIONES AUXILIARES ========
    function getClassificationColor(c){
      return { naturals:'#e74c3c', integers:'#f39c12', rationals:'#27ae60', irrationals:'#8e44ad' }[c] || '#3498db';
    }

    function updateDisplay(){
      drawNumberLine();
      updatePointsList();
      updateDistanceSelectors();
    }

    function drawNumberLine(){
      const numberLine = document.getElementById('numberLine');
      numberLine.innerHTML = '';
      const base = document.createElement('div');
      base.className = 'line';
      numberLine.appendChild(base);

      // Ticks y etiquetas
      const tickCount = currentRange * 2 + 1;
      for (let i=0;i<tickCount;i++){
        const value = -currentRange + i;
        const pct = (i / (tickCount - 1)) * 90 + 5;

        const tick = document.createElement('div');
        tick.className = 'tick';
        tick.style.left = pct + '%';
        numberLine.appendChild(tick);

        const label = document.createElement('div');
        label.className = 'tick-label';
        label.style.left = pct + '%';
        label.textContent = value;
        numberLine.appendChild(label);
      }

      // Puntos
      points.forEach((p, idx)=>{
        const pct = ((p.value + currentRange) / (2*currentRange)) * 90 + 5;
        const dot = document.createElement('div');
        dot.className = `number-point ${p.classification}`;
        dot.style.left = pct + '%';

        const tag = document.createElement('div');
        tag.className = 'point-label';
        tag.textContent = `${p.originalInput} ≈ ${p.value.toFixed(3)}`;
        dot.appendChild(tag);

        dot.title = `${p.originalInput} (${getClassificationName(p.classification)})\nHaz clic para eliminar`;
        dot.onclick = () => removePoint(idx);

        numberLine.appendChild(dot);
      });
    }

    function removePoint(i){
      if (confirm('¿Deseas eliminar este punto?')){
        points.splice(i,1);
        updateDisplay();
      }
    }

    function updatePointsList(){
      const box = document.getElementById('pointsList');
      if (points.length === 0){
        box.innerHTML = `
          <div class="empty-state">
            <p>Agrega números para ver su clasificación automática aquí</p>
            <small>Los puntos aparecerán ordenados de menor a mayor</small>
          </div>`;
        return;
      }
      const sorted = [...points].sort((a,b)=>a.value-b.value);
      box.innerHTML = sorted.map(p=>`
        <div class="point-item" style="border-left-color:${getClassificationColor(p.classification)}">
          <div>
            <strong>${p.originalInput}</strong> ≈ ${p.value.toFixed(6)}<br>
            <small>${getClassificationName(p.classification)}</small>
          </div>
          <div style="text-align:right">
            <small>Posición: ${p.value.toFixed(3)}</small>
          </div>
        </div>
      `).join('');
    }

    // ======== Calculadora de distancias (selects personalizados) ========
    function updateDistanceSelectors(){
      const itemsA = document.getElementById('pointA-items');
      const itemsB = document.getElementById('pointB-items');
      const selA = document.getElementById('pointA-selected');
      const selB = document.getElementById('pointB-selected');

      itemsA.innerHTML = '<div data-value="">Selecciona un punto</div>';
      itemsB.innerHTML = '<div data-value="">Selecciona un punto</div>';

      if (points.length === 0){
        selA.textContent = 'Selecciona un punto';
        selB.textContent = 'Selecciona un punto';
        document.getElementById('pointA-container').setAttribute('data-value','');
        document.getElementById('pointB-container').setAttribute('data-value','');
        return;
      }
      points.forEach((p, idx)=>{
        const label = `${p.originalInput} (${p.value.toFixed(3)})`;
        const a = document.createElement('div'); a.setAttribute('data-value', idx); a.textContent = label;
        const b = document.createElement('div'); b.setAttribute('data-value', idx); b.textContent = label;
        itemsA.appendChild(a); itemsB.appendChild(b);
      });

      // Activar clicks
      initCustomSelects();
    }

    function calculateDistance(){
      const aIdx = document.getElementById('pointA-container').getAttribute('data-value');
      const bIdx = document.getElementById('pointB-container').getAttribute('data-value');
      const out = document.getElementById('distanceResult');

      if (!aIdx || !bIdx){
        out.innerHTML = '<div class="distance-result" style="background:#fff7e6;border-color:#ffd89b;color:#7a4b00">Selecciona ambos puntos para calcular la distancia</div>';
        return;
      }
      if (aIdx === bIdx){
        out.innerHTML = '<div class="distance-result" style="background:#ffecec;border-color:#ffc7c7;color:#7a1f1f">Selecciona dos puntos diferentes</div>';
        return;
      }
      const A = points[parseInt(aIdx)], B = points[parseInt(bIdx)];
      const d = Math.abs(A.value - B.value);
      out.innerHTML = `
        <div class="distance-result">
          <strong>Distancia entre ${A.originalInput} y ${B.originalInput}:</strong><br>
          |${A.value.toFixed(3)} - ${B.value.toFixed(3)}| = ${d.toFixed(6)} unidades
        </div>`;
    }

    function initCustomSelects(){
      ['pointA','pointB'].forEach(id=>{
        const container = document.getElementById(id+'-container');
        const selected  = document.getElementById(id+'-selected');
        const items     = document.getElementById(id+'-items');

        // Evitar múltiples listeners duplicados
        if (selected.dataset.bound) return;
        selected.dataset.bound = '1';

        selected.addEventListener('click', (e)=>{
          e.stopPropagation();
          // Cerrar otros
          document.querySelectorAll('.select-items').forEach(it=>{ if (it!==items) it.classList.remove('show'); });
          document.querySelectorAll('.select-selected').forEach(ss=>{ if (ss!==selected) ss.classList.remove('select-arrow-active'); });

          const open = items.classList.contains('show');
          if (open){
            items.classList.remove('show'); selected.classList.remove('select-arrow-active'); adjustZIndex(null);
          } else {
            items.classList.add('show'); selected.classList.add('select-arrow-active'); adjustZIndex(id);
          }
        });

        items.addEventListener('click', (e)=>{
          e.stopPropagation();
          if (e.target.hasAttribute('data-value')){
            selected.textContent = e.target.textContent;
            container.setAttribute('data-value', e.target.getAttribute('data-value'));

            items.querySelectorAll('.selected').forEach(x=>x.classList.remove('selected'));
            e.target.classList.add('selected');

            items.classList.remove('show');
            selected.classList.remove('select-arrow-active');
            adjustZIndex(null);
          }
        });
      });

      document.addEventListener('click', ()=>{
        document.querySelectorAll('.select-items').forEach(i=>i.classList.remove('show'));
        document.querySelectorAll('.select-selected').forEach(s=>s.classList.remove('select-arrow-active'));
        adjustZIndex(null);
      }, { once:true });
    }

    function adjustZIndex(activeId){
      document.querySelectorAll('.distance-field').forEach(f=>f.style.zIndex='100');
      document.querySelectorAll('.distance-field .custom-select').forEach(s=>s.style.zIndex='101');
      document.querySelectorAll('.distance-field .select-items').forEach(i=>i.style.zIndex='1000');

      if (activeId){
        const field = document.getElementById(activeId+'-container').closest('.distance-field');
        const select = document.getElementById(activeId+'-container');
        const items = document.getElementById(activeId+'-items');
        if (field) field.style.zIndex='2000';
        if (select) select.style.zIndex='2001';
        if (items) items.style.zIndex='12000';
      }
    }

    // ======== INTERACCIÓN ========
    function addNumber(){
      const inputEl = document.getElementById('numberInput');
      const raw = inputEl.value;
      if (!raw){ alert('Por favor ingresa un número'); return; }

      const value = parseNumber(raw);
      if (value === null){ alert('Formato no válido. Ejemplos válidos: sqrt(7), 2*π, 1/e, √2, -1/2'); return; }
      if (Math.abs(value) > currentRange){ alert(`El número está fuera del rango actual (-${currentRange} a ${currentRange}). Cambia el rango de visualización.`); return; }

      // Evitar duplicados con tolerancia
      const exists = points.find(p => Math.abs(p.value - value) < 1e-4);
      if (exists){ alert('Este número ya está en la recta numérica'); return; }

      const classification = classifyNumber(value, raw);
      points.push({ value, originalInput: raw, classification });
      inputEl.value = '';
      updateDisplay();
    }

    function addPresetNumber(expr){
      const value = parseNumber(expr);
      if (value === null || Math.abs(value) > currentRange){ alert(`El número ${expr} está fuera del rango actual`); return; }
      const exists = points.find(p => Math.abs(p.value - value) < 1e-4);
      if (exists){ alert('Este número ya está en la recta numérica'); return; }
      const classification = classifyNumber(value, expr);
      points.push({ value, originalInput: expr, classification });
      updateDisplay();
    }

    function clearAll(){ points = []; updateDisplay(); }

    // Enter para agregar + inicialización
    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('numberInput').addEventListener('keypress', (e)=>{
        if (e.key === 'Enter') addNumber();
      });
      updateDisplay();
    });
  </script>
</body>
</html>