<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora de Productos Notables - Números Complejos</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&family=Playwrite+GB+J:ital,wght@0,100..400;1,100..400&display=swap" rel="stylesheet" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <style>
        /* ==================== RESET BÁSICO ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        /* ==================== ESTRUCTURA GENERAL ==================== */
        body {
            font-family:"Lexend Deca", sans-serif;
            background-color: #fdfcf9;
            color: #39190F;
            padding: 20px;
            line-height: 1.6;
            font-size: 16px;
        }
        .container{
            max-width:950px;
            margin:0 auto;
            background-color: #fffaf5;
            border: 3px solid #d8b99b;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 6px 6px 0 #b08968;
        }
  header{background:#fff; color:var(--pink-600); border:1px solid var(--border); border-radius: var(--radius); padding:28px 20px; background-image: linear-gradient(180deg, #ffffff, #fff7fb);} 
  header h1{font-size:1.8rem; font-weight:800; margin-bottom:6px; color: var(--opi);} 
  .subtitle{opacity:.95; font-weight:600}
  .badge{ display:inline-block; margin-left:10px; padding:3px 8px; border-radius:999px; background:#fce7f3; border:1px solid #f8cfe3; color:#be185d; font-weight:700; font-size:.78rem; }
  main{display:grid; gap:18px;}
  .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:18px}
  .card h2{font-size:1rem; color:#334155; margin-bottom:8px}
  .controls .grid{display:grid; grid-template-columns: repeat(12, 1fr); gap:12px}
  .col-12{grid-column: span 12}
  .col-6{grid-column: span 6}
  .field label{display:block; font-weight:700; margin:2px 0 6px}
  .input{width:100%; padding:10px 12px; border:1.5px solid var(--border); border-radius:8px; font-size:1rem; background:#fff; outline:none}
  .input:focus{border-color: var(--pink)}
  .hint{font-size:.82rem; color:var(--muted); margin-top:4px}
  .btn{border:none; border-radius:8px; padding:12px 14px; font-weight:800; font-size:1rem; cursor:pointer}
  .btn-primary{background: var(--pink); color:#fff}
  .btn-primary:hover{background: var(--pink-600)}
  .btn-danger{background:#ef4444; color:#fff}
  .results{display:grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap:12px}
  .result-card{border-left:4px solid var(--pink)}
  .expression{font-weight:800; color:var(--pink-600); background:var(--pink-100); padding:10px 12px; border-radius:8px; text-align:center}
  .formula{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#fff; border:1px dashed var(--border); padding:10px 12px; border-radius:8px; color:#334155}
  .steps{color:#475569}
  .steps div{padding:6px 0; border-bottom:1px dashed var(--border)}
  .steps div:last-child{border-bottom:none}
  .expression-result{text-align:center; font-weight:800; color:#065f46; background:#ecfdf5; border:1px solid #a7f3d0; padding:10px 12px; border-radius:8px}
  .numeric-result{text-align:center; font-size:1.2rem; font-weight:800; padding:12px; border-radius:8px; background:#fff}
  .verification{padding:10px 12px; border-radius:8px; font-weight:700}
  .verification.correcto{background:#ecfdf5; color:#16a34a; border:1.5px solid #86efac}
  .verification.incorrecto{background:#fef2f2; color:#ef4444; border:1.5px solid #fecaca}
  .visualization h2{margin-bottom:6px}
  #canvas-geometrico{display:block; margin:12px auto; background:#fff; border-radius:8px; border:1.5px dashed var(--border)}
  .geo-description{text-align:center; color:var(--muted)}
  .historial-header{display:flex; align-items:center; justify-content:space-between; gap:10px}
  .historial{display:grid; gap:8px}
  .historial-item{padding:10px 12px; border-radius:8px; border:1px solid var(--border); background:#fff}
  .historial-item strong{color: var(--pink-600)}
  .historial-vacio{text-align:center; color:var(--muted); padding:16px}
  footer{text-align:center; padding:20px; color:var(--muted)}
  @media (max-width:820px){ .controls .grid{grid-template-columns:1fr} .col-6{grid-column:1} }
  .shimmer{ position:relative; overflow:hidden }
  .shimmer::before{
    content:""; position:absolute; inset:0; transform: translateX(-100%);
    background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.6) 25%, transparent 50%);
    animation: shimmer 2.2s ease-in-out infinite; pointer-events:none;
  }
  @keyframes shimmer{ 0%{ transform: translateX(-100%) } 100%{ transform: translateX(100%) } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Calculadora de Productos Notables</h1>
      <p class="subtitle">Actividad 10 · Unidad II <span class="badge">Michelle Cámara González</span></p>
    </header>

    <main>
      <section class="card controls" id="controles">
        <div class="grid">
          <div class="field col-12">
            <label for="modo">Modo de cálculo</label>
            <select id="modo" class="input">
              <option value="numerico">Numérico — solo números</option>
              <option value="algebraico">Algebraico — con variables</option>
            </select>
          </div>

          <div class="field col-12">
            <label for="tipo">Tipo de producto notable</label>
            <select id="tipo" class="input">
              <option value="binomio-cuadrado-suma">Binomio al cuadrado (a + b)²</option>
              <option value="binomio-cuadrado-resta">Binomio al cuadrado (a - b)²</option>
              <option value="binomio-cubo-suma">Binomio al cubo (a + b)³</option>
              <option value="binomio-cubo-resta">Binomio al cubo (a - b)³</option>
              <option value="termino-comun">Término común (x + a)(x + b)</option>
              <option value="conjugados">Binomios conjugados (a + b)(a - b)</option>
            </select>
          </div>

          <div class="field col-6">
            <label for="valor-a">Valor de a</label>
            <input id="valor-a" class="input" type="text" value="3" placeholder="Ej: 3 o 3x" />
            <div class="hint">Numérico: 3 · Algebraico: 3x, 5y</div>
          </div>
          <div class="field col-6">
            <label for="valor-b">Valor de b</label>
            <input id="valor-b" class="input" type="text" value="2" placeholder="Ej: 2 o 5y" />
            <div class="hint">Numérico: 2 · Algebraico: 5y, 2z</div>
          </div>

          <div class="col-12" style="display:flex; gap:10px; align-items:center;">
            <button id="calcular" class="btn btn-primary shimmer" style="min-width:180px">Calcular</button>
            <small class="hint">Pulsa Enter para calcular</small>
          </div>
        </div>
      </section>

      <section class="results" aria-live="polite">
        <div class="card result-card">
          <h2>Expresión original</h2>
          <div id="expresion-original" class="expression">—</div>
        </div>
        <div class="card result-card">
          <h2>Fórmula aplicada</h2>
          <div id="formula" class="formula">—</div>
        </div>
        <div class="card result-card">
          <h2>Desarrollo paso a paso</h2>
          <div id="desarrollo" class="steps">—</div>
        </div>
        <div class="card result-card">
          <h2>Forma expandida</h2>
          <div id="expandida" class="expression-result">—</div>
        </div>
        <div class="card result-card">
          <h2>Resultado numérico</h2>
          <div id="resultado-numerico" class="numeric-result">—</div>
        </div>
        <div class="card result-card">
          <h2>Verificación</h2>
          <div id="verificacion" class="verification">—</div>
        </div>
      </section>

      <section class="card visualization">
        <h2>Representación geométrica</h2>
        <canvas id="canvas-geometrico" width="420" height="420"></canvas>
        <p id="descripcion-geometrica" class="geo-description"></p>
      </section>

      <section class="card historial-container">
        <div class="historial-header">
          <h2>Historial de cálculos</h2>
          <button id="limpiar-historial" class="btn btn-danger">Limpiar</button>
        </div>
        <div id="historial" class="historial"></div>
      </section>
    </main>

    <footer style="text-align:center; color:var(--ink-500); padding:28px;">
      <small>© 2025 · Fundamentos de Álgebra · TSU en Desarrollo de Software</small>
    </footer>
  </div>

  <script>
    let historialCalculos = [];

    const btnCalcular = document.getElementById('calcular');
    const selectTipo = document.getElementById('tipo');
    const selectModo = document.getElementById('modo');
    const inputA = document.getElementById('valor-a');
    const inputB = document.getElementById('valor-b');
    const btnLimpiarHistorial = document.getElementById('limpiar-historial');

    const expresionOriginal = document.getElementById('expresion-original');
    const formula = document.getElementById('formula');
    const desarrollo = document.getElementById('desarrollo');
    const expandida = document.getElementById('expandida');
    const resultadoNumerico = document.getElementById('resultado-numerico');
    const verificacion = document.getElementById('verificacion');
    const canvas = document.getElementById('canvas-geometrico');
    const descripcionGeometrica = document.getElementById('descripcion-geometrica');
    const historial = document.getElementById('historial');

    btnCalcular.addEventListener('click', calcular);
    btnLimpiarHistorial.addEventListener('click', limpiarHistorial);
    selectModo.addEventListener('change', actualizarPlaceholders);
    window.addEventListener('load', () => { cargarHistorial(); mostrarHistorial(); limpiarCanvas(); });

    [inputA, inputB].forEach(el => el.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ calcular(); } }));

    function pulseCards(){
      document.querySelectorAll('.result-card').forEach(card=>{
        card.classList.remove('pop');
        void card.offsetWidth;
        card.classList.add('pop');
      });
    }

    function actualizarPlaceholders(){
      const modo = selectModo.value;
      if (modo === 'numerico'){
        inputA.placeholder = 'Ej: 3'; inputB.placeholder = 'Ej: 2'; inputA.value='3'; inputB.value='2';
      } else {
        inputA.placeholder = 'Ej: 3x'; inputB.placeholder = 'Ej: 5y'; inputA.value='3x'; inputB.value='5y';
      }
      limpiarCanvas();
    }

    function calcular(){
      const tipo = selectTipo.value;
      const modo = selectModo.value;
      const a = (inputA.value||'').trim();
      const b = (inputB.value||'').trim();
      if(!a || !b){ toast('Ingresa valores en ambos campos', true); return; }

      try{
        const resultado = (modo==='numerico') ? calcularNumerico(tipo, a, b) : calcularAlgebraico(tipo, a, b);
        mostrarResultados(resultado);
        if(modo==='numerico') dibujarGeometria(tipo, parseFloat(a), parseFloat(b), resultado); else limpiarCanvas();
        agregarAlHistorial(resultado);
        pulseCards();
      }catch(err){ toast('Error en el cálculo: '+ err.message, true); console.error(err); }
    }

    function toast(msg, danger=false){
      const t = document.createElement('div');
      t.textContent = msg; t.setAttribute('role','status');
      t.style.position='fixed'; t.style.left='50%'; t.style.top='18px'; t.style.transform='translateX(-50%)';
      t.style.background = danger ? '#fee2e2' : '#ecfeff';
      t.style.border = `2px solid ${danger? '#fca5a5':'#67e8f9'}`;
      t.style.color = danger ? '#b91c1c' : '#0e7490';
      t.style.padding='10px 14px'; t.style.borderRadius='12px'; t.style.boxShadow='0 10px 20px rgba(0,0,0,.08)';
      t.style.fontWeight='600'; t.style.zIndex='9999';
      document.body.appendChild(t);
      setTimeout(()=>{ t.style.transition='opacity .35s ease, transform .35s ease'; t.style.opacity='0'; t.style.transform='translateX(-50%) translateY(-6px)'; }, 1400);
      setTimeout(()=> t.remove(), 1850);
    }

    function calcularNumerico(tipo, aStr, bStr){
      const a = parseFloat(aStr); const b = parseFloat(bStr);
      if(Number.isNaN(a)||Number.isNaN(b)) throw new Error('Los valores deben ser numéricos');
      switch(tipo){
        case 'binomio-cuadrado-suma': return binomioCuadradoSumaNumerico(a,b);
        case 'binomio-cuadrado-resta': return binomioCuadradoRestaNumerico(a,b);
        case 'binomio-cubo-suma': return binomioCuboSumaNumerico(a,b);
        case 'binomio-cubo-resta': return binomioCuboRestaNumerico(a,b);
        case 'termino-comun': return terminoComunNumerico(a,b);
        case 'conjugados': return conjugadosNumerico(a,b);
      }
    }

    function calcularAlgebraico(tipo, a, b){
      switch(tipo){
        case 'binomio-cuadrado-suma': return binomioCuadradoSumaAlgebraico(a,b);
        case 'binomio-cuadrado-resta': return binomioCuadradoRestaAlgebraico(a,b);
        case 'binomio-cubo-suma': return binomioCuboSumaAlgebraico(a,b);
        case 'binomio-cubo-resta': return binomioCuboRestaAlgebraico(a,b);
        case 'termino-comun': return terminoComunAlgebraico(a,b);
        case 'conjugados': return conjugadosAlgebraico(a,b);
      }
    }

    function binomioCuadradoSumaAlgebraico(a,b){
      const expr = `(${a} + ${b})^2`; const expandido = math.simplify(expr).toString();
      return { tipo:'Binomio al Cuadrado (Suma)', expresion:`(${a} + ${b})²`, formula:'(a + b)² = a² + 2ab + b²', pasos:[`Paso 1: Expresión: (${a} + ${b})²`,`Paso 2: Aplicar fórmula: a² + 2ab + b²`,`Paso 3: a² = (${a})²`,`Paso 4: 2ab = 2(${a})(${b})`,`Paso 5: b² = (${b})²`,`Paso 6: Resultado expandido`], expandida:expandido, numerico:'Modo algebraico', verificacion:true, resultadoDirecto: expandido };
    }
    function binomioCuadradoRestaAlgebraico(a,b){
      const expr = `(${a} - ${b})^2`; const expandido = math.simplify(expr).toString();
      return { tipo:'Binomio al Cuadrado (Resta)', expresion:`(${a} - ${b})²`, formula:'(a - b)² = a² - 2ab + b²', pasos:[`Paso 1: Expresión: (${a} - ${b})²`,`Paso 2: Aplicar fórmula: a² - 2ab + b²`,`Paso 3: a² = (${a})²`,`Paso 4: 2ab = 2(${a})(${b})`,`Paso 5: b² = (${b})²`,`Paso 6: Resultado expandido`], expandida:expandido, numerico:'Modo algebraico', verificacion:true, resultadoDirecto: expandido };
    }
    function binomioCuboSumaAlgebraico(a,b){
      const expr = `(${a} + ${b})^3`; const expandido = math.simplify(expr).toString();
      return { tipo:'Binomio al Cubo (Suma)', expresion:`(${a} + ${b})³`, formula:'(a + b)³ = a³ + 3a²b + 3ab² + b³', pasos:[`Paso 1: Expresión: (${a} + ${b})³`,`Paso 2: Aplicar fórmula del cubo`,`Paso 3: a³ = (${a})³`,`Paso 4: 3a²b = 3(${a})²(${b})`,`Paso 5: 3ab² = 3(${a})(${b})²`,`Paso 6: b³ = (${b})³`,`Paso 7: Resultado expandido`], expandida:expandido, numerico:'Modo algebraico', verificacion:true, resultadoDirecto: expandido };
    }
    function binomioCuboRestaAlgebraico(a,b){
      const expr = `(${a} - ${b})^3`; const expandido = math.simplify(expr).toString();
      return { tipo:'Binomio al Cubo (Resta)', expresion:`(${a} - ${b})³`, formula:'(a - b)³ = a³ - 3a²b + 3ab² - b³', pasos:[`Paso 1: Expresión: (${a} - ${b})³`,`Paso 2: Aplicar fórmula del cubo con resta`,`Paso 3: a³ = (${a})³`,`Paso 4: 3a²b = 3(${a})²(${b})`,`Paso 5: 3ab² = 3(${a})(${b})²`,`Paso 6: b³ = (${b})³`,`Paso 7: Resultado con signos alternados`], expandida:expandido, numerico:'Modo algebraico', verificacion:true, resultadoDirecto: expandido };
    }
    function terminoComunAlgebraico(a,b){
      const expr = `(x + ${a}) * (x + ${b})`; const expandido = math.simplify(expr).toString();
      return { tipo:'Término Común', expresion:`(x + ${a})(x + ${b})`, formula:'(x + a)(x + b) = x² + (a+b)x + ab', pasos:[`Paso 1: Expresión: (x + ${a})(x + ${b})`,`Paso 2: Término cuadrático: x²`,`Paso 3: Término lineal: (${a} + ${b})x`,`Paso 4: Término independiente: (${a})(${b})`,`Paso 5: Resultado expandido`], expandida:expandido, numerico:'Modo algebraico', verificacion:true, resultadoDirecto: expandido };
    }
    function conjugadosAlgebraico(a,b){
      const expr = `(${a} + ${b}) * (${a} - ${b})`; const expandido = math.simplify(expr).toString();
      return { tipo:'Binomios Conjugados', expresion:`(${a} + ${b})(${a} - ${b})`, formula:'(a + b)(a - b) = a² - b²', pasos:[`Paso 1: Expresión: (${a} + ${b})(${a} - ${b})`,`Paso 2: Aplicar diferencia de cuadrados`,`Paso 3: a² = (${a})²`,`Paso 4: b² = (${b})²`,`Paso 5: Resultado: a² - b²`], expandida:expandido, numerico:'Modo algebraico', verificacion:true, resultadoDirecto: expandido };
    }

    function binomioCuadradoSumaNumerico(a,b){
      const a2=a*a, ab2=2*a*b, b2=b*b; const resultadoFinal = a2+ab2+b2; const resultadoDirecto = Math.pow(a+b,2);
      return { tipo:'Binomio al Cuadrado (Suma)', expresion:`(${a} + ${b})²`, formula:'(a + b)² = a² + 2ab + b²', pasos:[`Paso 1: Identificar a = ${a} y b = ${b}`,`Paso 2: Calcular a² = ${a}² = ${a2}`,`Paso 3: Calcular 2ab = 2(${a})(${b}) = ${ab2}`,`Paso 4: Calcular b² = ${b}² = ${b2}`,`Paso 5: Sumar: ${a2} + ${ab2} + ${b2} = ${resultadoFinal}`], expandida:`${a2} + ${ab2} + ${b2}`, numerico: resultadoFinal.toFixed(4), verificacion: Math.abs(resultadoFinal-resultadoDirecto)<1e-4, resultadoDirecto: resultadoDirecto.toFixed(4) };
    }
    function binomioCuadradoRestaNumerico(a,b){
      const a2=a*a, ab2=2*a*b, b2=b*b; const resultadoFinal = a2-ab2+b2; const resultadoDirecto = Math.pow(a-b,2);
      return { tipo:'Binomio al Cuadrado (Resta)', expresion:`(${a} - ${b})²`, formula:'(a - b)² = a² - 2ab + b²', pasos:[`Paso 1: Identificar a = ${a} y b = ${b}`,`Paso 2: Calcular a² = ${a}² = ${a2}`,`Paso 3: Calcular 2ab = 2(${a})(${b}) = ${ab2}`,`Paso 4: Calcular b² = ${b}² = ${b2}`,`Paso 5: Operar: ${a2} - ${ab2} + ${b2} = ${resultadoFinal}`], expandida:`${a2} - ${ab2} + ${b2}`, numerico: resultadoFinal.toFixed(4), verificacion: Math.abs(resultadoFinal-resultadoDirecto)<1e-4, resultadoDirecto: resultadoDirecto.toFixed(4) };
    }
    function binomioCuboSumaNumerico(a,b){
      const a3=a*a*a, a2b3=3*a*a*b, ab23=3*a*b*b, b3=b*b*b; const resultadoFinal=a3+a2b3+ab23+b3; const resultadoDirecto=Math.pow(a+b,3);
      return { tipo:'Binomio al Cubo (Suma)', expresion:`(${a} + ${b})³`, formula:'(a + b)³ = a³ + 3a²b + 3ab² + b³', pasos:[`Paso 1: a = ${a}, b = ${b}`,`Paso 2: a³ = ${a3}`,`Paso 3: 3a²b = ${a2b3}`,`Paso 4: 3ab² = ${ab23}`,`Paso 5: b³ = ${b3}`,`Paso 6: Suma = ${resultadoFinal}`], expandida:`${a3} + ${a2b3} + ${ab23} + ${b3}`, numerico: resultadoFinal.toFixed(4), verificacion: Math.abs(resultadoFinal-resultadoDirecto)<1e-4, resultadoDirecto: resultadoDirecto.toFixed(4) };
    }
    function binomioCuboRestaNumerico(a,b){
      const a3=a*a*a, a2b3=3*a*a*b, ab23=3*a*b*b, b3=b*b*b; const resultadoFinal=a3-a2b3+ab23-b3; const resultadoDirecto=Math.pow(a-b,3);
      return { tipo:'Binomio al Cubo (Resta)', expresion:`(${a} - ${b})³`, formula:'(a - b)³ = a³ - 3a²b + 3ab² - b³', pasos:[`Paso 1: a = ${a}, b = ${b}`,`Paso 2: a³ = ${a3}`,`Paso 3: 3a²b = ${a2b3}`,`Paso 4: 3ab² = ${ab23}`,`Paso 5: b³ = ${b3}`,`Paso 6: Alterna signos = ${resultadoFinal}`], expandida:`${a3} - ${a2b3} + ${ab23} - ${b3}`, numerico: resultadoFinal.toFixed(4), verificacion: Math.abs(resultadoFinal-resultadoDirecto)<1e-4, resultadoDirecto: resultadoDirecto.toFixed(4) };
    }
    function terminoComunNumerico(a,b){
      const sumaAB=a+b, productoAB=a*b; const valorX=1; const resultadoFinal = (valorX*valorX) + (sumaAB*valorX) + productoAB; const resultadoDirecto = (1+a)*(1+b);
      return { tipo:'Término Común', expresion:`(x + ${a})(x + ${b})`, formula:'(x + a)(x + b) = x² + (a+b)x + ab', pasos:[`Paso 1: a = ${a}, b = ${b}`,`Paso 2: x²`, `Paso 3: (a+b)x = ${sumaAB}x`, `Paso 4: ab = ${productoAB}`, `Paso 5: Resultado expandido`], expandida:`x² + ${sumaAB}x + ${productoAB}`, numerico:`Para x=1: ${resultadoFinal.toFixed(4)}`, verificacion: Math.abs(resultadoFinal-resultadoDirecto)<1e-4, resultadoDirecto: resultadoDirecto.toFixed(4) };
    }
    function conjugadosNumerico(a,b){
      const a2=a*a, b2=b*b; const resultadoFinal=a2-b2; const resultadoDirecto=(a+b)*(a-b);
      return { tipo:'Binomios Conjugados', expresion:`(${a} + ${b})(${a} - ${b})`, formula:'(a + b)(a - b) = a² - b²', pasos:[`Paso 1: a² = ${a2}`,`Paso 2: b² = ${b2}`,`Paso 3: Diferencia = ${resultadoFinal}`], expandida:`${a2} - ${b2}`, numerico: resultadoFinal.toFixed(4), verificacion: Math.abs(resultadoFinal-resultadoDirecto)<1e-4, resultadoDirecto: resultadoDirecto.toFixed(4) };
    }

    function mostrarResultados(r){
      expresionOriginal.textContent = r.expresion;
      formula.textContent = r.formula;
      desarrollo.innerHTML='';
      r.pasos.forEach(p=>{ const d=document.createElement('div'); d.textContent=p; desarrollo.appendChild(d); });
      expandida.textContent = r.expandida;
      resultadoNumerico.textContent = r.numerico;
      if(r.verificacion){ verificacion.textContent = `✓ Verificación correcta: ${r.resultadoDirecto}`; verificacion.className='verification correcto'; }
      else{ verificacion.textContent = `✗ Error en verificación`; verificacion.className='verification incorrecto'; }
    }

    function limpiarCanvas(){
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width, canvas.height);
      const size=24; ctx.strokeStyle='#f3d0e6'; ctx.lineWidth=1;
      for(let x=0; x<canvas.width; x+=size){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke(); }
      for(let y=0; y<canvas.height; y+=size){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke(); }
      ctx.fillStyle = '#9f1239';
      ctx.font = '600 14px Inter, sans-serif';
      ctx.textAlign='center';
      ctx.fillText('Visualización disponible en modo numérico', canvas.width/2, canvas.height/2);
      descripcionGeometrica.textContent='';
    }

    function dibujarGeometria(tipo, a, b, resultado){
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width, canvas.height);

      const g = ctx.createLinearGradient(0,0,0,canvas.height);
      g.addColorStop(0, '#fff'); g.addColorStop(1, '#ffe7f3');
      ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width, canvas.height);

      const centerX=canvas.width/2, centerY=canvas.height/2, scale=30;

      if(tipo.includes('cuadrado')){
        const lado = (a + Math.abs(b)) * scale;
        const x = centerX - lado/2; const y = centerY - lado/2;
        const aS = a*scale; const bS = Math.abs(b)*scale;

        ctx.strokeStyle = '#ec4899'; ctx.lineWidth=3; ctx.strokeRect(x,y,lado,lado);

        ctx.fillStyle = 'rgba(236,72,153,.25)'; ctx.fillRect(x,y,aS,aS);
        ctx.strokeStyle = '#db2777'; ctx.strokeRect(x,y,aS,aS);
        ctx.fillStyle = '#581c87'; ctx.font='bold 14px Inter'; ctx.fillText('a²', x + aS/2, y + aS/2);

        ctx.fillStyle = 'rgba(244,114,182,.25)';
        ctx.fillRect(x + aS, y, bS, aS);
        ctx.fillRect(x, y + aS, aS, bS);
        ctx.fillStyle = '#7c3aed'; ctx.fillText('ab', x + aS + bS/2, y + aS/2);
        ctx.fillText('ab', x + aS/2, y + aS + bS/2);

        ctx.fillStyle = 'rgba(219,39,119,.25)';
        ctx.fillRect(x + aS, y + aS, bS, bS);
        ctx.strokeStyle = '#be185d'; ctx.strokeRect(x + aS, y + aS, bS, bS);
        ctx.fillStyle = '#7c2d12'; ctx.fillText('b²', x + aS + bS/2, y + aS + bS/2);

        descripcionGeometrica.textContent = `Área total = (${a} + ${b})² = ${resultado.numerico} unidades²`;
      }
      else if(tipo==='conjugados'){
        const a2=a*scale, b2=Math.abs(b)*scale;
        ctx.fillStyle='rgba(236,72,153,.22)'; ctx.fillRect(centerX - a2/2, centerY - a2/2, a2, a2);
        ctx.strokeStyle='#ec4899'; ctx.lineWidth=3; ctx.strokeRect(centerX - a2/2, centerY - a2/2, a2, a2);

        ctx.fillStyle='rgba(219,39,119,.35)'; ctx.fillRect(centerX - b2/2, centerY - b2/2, b2, b2);
        ctx.strokeStyle='#db2777'; ctx.lineWidth=2; ctx.strokeRect(centerX - b2/2, centerY - b2/2, b2, b2);

        ctx.fillStyle='#374151'; ctx.font='bold 15px Inter';
        ctx.fillText('a²', centerX - a2/2 + 16, centerY - a2/2 + 22);
        ctx.fillText('b²', centerX, centerY + 6);

        descripcionGeometrica.textContent = `Diferencia de áreas = ${a}² − ${b}² = ${resultado.numerico} unidades²`;
      }
      else{
        limpiarCanvas();
      }
    }

    function agregarAlHistorial(r){
      const item = { fecha:new Date().toLocaleString('es-MX'), tipo:r.tipo, expresion:r.expresion, resultado:r.expandida || r.numerico };
      historialCalculos.unshift(item); if(historialCalculos.length>10) historialCalculos.pop();
      guardarHistorial(); mostrarHistorial();
    }
    function mostrarHistorial(){
      if(historialCalculos.length===0){ historial.innerHTML='<div class="historial-vacio">No hay cálculos en el historial</div>'; return; }
      historial.innerHTML='';
      historialCalculos.forEach(i=>{
        const d=document.createElement('div'); d.className='historial-item';
        d.innerHTML=`<strong>${i.tipo}</strong><br>${i.expresion} = ${i.resultado}<br><small>${i.fecha}</small>`;
        historial.appendChild(d);
      });
    }
    function limpiarHistorial(){ if(confirm('¿Seguro que quieres limpiar el historial?')){ historialCalculos=[]; guardarHistorial(); mostrarHistorial(); } }
    function guardarHistorial(){ localStorage.setItem('historialProductosNotables', JSON.stringify(historialCalculos)); }
    function cargarHistorial(){ const g = localStorage.getItem('historialProductosNotables'); if(g){ try{ historialCalculos = JSON.parse(g)||[]; }catch{ historialCalculos=[]; } } }
  </script>
</body>
</html>
